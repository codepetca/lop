# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

EasyPoll is a real-time polling application built with SvelteKit and PartyKit. It generates random poll questions server-side and allows users to vote and see live results via WebSocket connections.

## Key Commands

### Development

```bash
npm run dev              # Run both SvelteKit and PartyKit dev servers
npm run dev:sveltekit    # Run only SvelteKit frontend
npm run dev:party        # Run only PartyKit WebSocket server
```

### Build & Deploy

```bash
npm run build            # Build production SvelteKit app
npm run preview          # Preview production build
npm run party:deploy     # Deploy PartyKit server to production
```

### Code Quality

```bash
npm run check            # TypeScript type checking
npm run check:watch      # Type check in watch mode
npm run lint             # Check code formatting
npm run format           # Auto-format code with Prettier
```

## Architecture

This is a full-stack real-time application with organized backend modules:

1. **SvelteKit Frontend** (`src/routes/`)
   - Server-side rendering with client-side interactivity
   - Simple poll creation and room joining interface
   - WebSocket client for real-time updates

2. **PartyKit Backend** (modular structure)
   - `party/index.ts` - Main server class and WebSocket handling
   - `party/handlers.ts` - Request/message handlers with business logic
   - `party/types.ts` - Zod schemas and TypeScript types
   - `party/questions.ts` - Question bank with 15+ diverse questions
   - `party/utils.ts` - Utility functions for poll management

3. **Shared Types** (`src/lib/types.ts`)
   - TypeScript interfaces used by frontend
   - PartyKit backend uses its own type definitions for better validation

## Key Patterns

### Poll Creation Flow

1. User clicks "Create Random Poll" button on homepage (`src/routes/+page.svelte`)
2. SvelteKit server action (`src/routes/+page.server.ts`) generates poll ID and requests server-generated poll
3. PartyKit selects random question from question bank and creates poll
4. Frontend displays poll ID for sharing, user can join poll immediately

### Real-time Voting Flow

1. Poll page establishes WebSocket connection to PartyKit room
2. User clicks vote option, sends WebSocket message
3. PartyKit updates vote count and broadcasts to all connected clients
4. All clients receive update and re-render vote counts

### Data Storage

- Polls are stored in PartyKit room storage (persisted automatically)
- Each poll has its own room identified by poll ID
- Questions are server-generated from a curated question bank
- Vote tracking uses client-side localStorage (not secure, suitable for casual polls)

## Important Files

- `party/index.ts` - Main PartyKit server class
- `party/handlers.ts` - Request and message handlers
- `party/types.ts` - Zod schemas and TypeScript types
- `party/questions.ts` - Question bank with 15+ diverse questions
- `party/utils.ts` - Utility functions
- `src/routes/+page.server.ts` - Poll creation server logic
- `src/routes/+page.svelte` - Home page with poll creation and room joining
- `src/routes/[poll_id]/+page.svelte` - Poll voting interface with WebSocket client
- `src/lib/types.ts` - Frontend TypeScript types

## Development Notes

- The app uses PartyKit's development server for local WebSocket testing
- Both servers must run for full functionality (`npm run dev`)
- Poll IDs are 9-character random strings generated by SvelteKit
- Questions are randomly selected from a curated bank of 15+ diverse questions
- No authentication system - all polls are anonymous
- Vote prevention is client-side only using localStorage
- Runtime type safety provided by Zod validation in PartyKit backend
